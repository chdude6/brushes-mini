<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brushes - Professional Photo Editor</title>
    <meta name="description" content="A professional photo editing suite focused on advanced brush controls and layer management.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        :root {
            /* Original Dark Editor Theme */
            --background: hsl(220, 10%, 10%);
            --foreground: hsl(210, 20%, 98%);
            --card: hsl(220, 12%, 12%);
            --card-foreground: hsl(210, 20%, 98%);
            --primary: hsl(340, 85%, 58%); /* Switched to a more 'Brushes' pink/red accent */
            --primary-foreground: hsl(210, 20%, 98%);
            --secondary: hsl(220, 15%, 15%);
            --muted: hsl(220, 15%, 18%);
            --muted-foreground: hsl(215, 20%, 65%);
            --accent: hsl(340, 85%, 58%);
            --border: hsl(220, 13%, 20%);
            --input: hsl(220, 13%, 18%);
            --editor-bg: hsl(220, 10%, 8%);
            --editor-panel: hsl(220, 12%, 12%);
            --editor-panel-border: hsl(220, 13%, 20%);
            --editor-toolbar: hsl(220, 14%, 14%);
            --editor-hover: hsl(220, 15%, 18%);
            --canvas-checker: repeating-conic-gradient(hsl(0, 0%, 25%) 0% 25%, hsl(0, 0%, 30%) 0% 50%) 50% / 20px 20px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--foreground);
            overflow: hidden;
        }

        .editor-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Toolbar */
        .top-toolbar {
            height: 48px;
            background: var(--editor-toolbar);
            border-bottom: 1px solid var(--editor-panel-border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 16px;
            flex-shrink: 0;
        }

        .toolbar-group {
            display: flex;
            gap: 8px;
        }

        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: var(--border);
        }

        .btn {
            background: var(--secondary);
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--editor-hover);
            border-color: var(--muted);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zoom-display {
             padding: 0 8px;
             font-size: 12px;
             color: var(--muted-foreground);
             min-width: 50px;
             text-align: center;
        }

        /* Main Layout */
        .main-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Tool Panel */
        .tool-panel {
            width: 280px;
            background: var(--editor-panel);
            border-right: 1px solid var(--editor-panel-border);
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .panel-section {
            background: var(--card);
            border: 1px solid var(--editor-panel-border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .panel-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
            color: var(--muted-foreground);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Color Swatches */
        .color-swatches {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .color-container {
            position: relative;
        }
        
        .color-input-wrapper {
             position: relative;
        }
        
        .color-input-wrapper input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .color-swatch {
            width: 48px;
            height: 48px;
            border: 2px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
        }

        .color-swatch.small {
            width: 32px;
            height: 32px;
            position: absolute;
            bottom: -8px;
            right: -8px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        .color-info {
            font-size: 12px;
            color: var(--muted-foreground);
        }

        /* Brush Settings */
        .setting-group {
            margin-bottom: 16px;
        }

        .setting-label {
            font-size: 12px;
            color: var(--muted-foreground);
            margin-bottom: 8px;
            display: block;
        }

        .slider {
            width: 100%;
            height: 6px;
            background: var(--secondary);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--background);
        }

        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-top: 8px;
        }

        .tool-btn-grid {
            background: var(--secondary);
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn-grid:hover {
            background: var(--editor-hover);
        }

        .tool-btn-grid.active {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: 0 0 10px hsla(340, 85%, 58%, 0.3);
        }

        /* Canvas Area */
        .canvas-area {
            flex: 1;
            background: var(--canvas-checker);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            position: relative;
        }

        .canvas-container {
            position: relative;
            box-shadow: 0 4px 16px hsl(220, 50%, 3%);
            background: white; /* Fallback for canvas */
        }

        #main-canvas {
            display: block;
        }

        /* Right Panels */
        .right-panels {
            width: 280px;
            background: var(--editor-panel);
            border-left: 1px solid var(--editor-panel-border);
            overflow-y: auto;
            padding: 16px;
        }

        /* Layers Panel */
        #layers-list {
            min-height: 100px;
            max-height: 40vh;
            overflow-y: auto;
            margin-bottom: 8px;
        }
        
        .layer-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .layer-item.active {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--accent);
        }
        
        .layer-item:hover:not(.active) {
            background: var(--editor-hover);
        }

        .layer-visibility {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .layer-name {
            flex: 1;
            font-size: 12px;
        }

        .layer-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeInOut 3s ease;
        }

        .toast.success { border-left: 4px solid #22c55e; }
        .toast.error { border-left: 4px solid #ef4444; }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translate(-50%, -20px); }
            10%, 90% { opacity: 1; transform: translate(-50%, 0); }
        }

        /* Scrollbars */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--secondary); }
        ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
    </style>
</head>
<body>
    <div class="editor-container">
        <!-- Top Toolbar -->
        <div class="top-toolbar">
            <div class="toolbar-group">
                <button class="btn" id="new-btn">New</button>
                <button class="btn" id="open-btn">Open</button>
                <button class="btn" id="save-btn">Export</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button class="btn" id="undo-btn">Undo</button>
                <button class="btn" id="redo-btn">Redo</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="zoom-controls">
                <button class="btn" id="zoom-out-btn">-</button>
                <span id="zoom-display" class="zoom-display">100%</span>
                <button class="btn" id="zoom-in-btn">+</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Tool Panel -->
            <div class="tool-panel">
                <!-- Color Swatches -->
                <div class="panel-section">
                    <div class="panel-title">Colors</div>
                    <div class="color-swatches">
                        <div class="color-container">
                             <div class="color-input-wrapper">
                                <div class="color-swatch" id="foreground-color-display"></div>
                                <input type="color" id="fg-color-input">
                            </div>
                            <div class="color-input-wrapper">
                                <div class="color-swatch small" id="background-color-display"></div>
                                <input type="color" id="bg-color-input">
                            </div>
                        </div>
                        <div class="color-info">
                            <div>FG: <span id="fg-text">#000000</span></div>
                            <div>BG: <span id="bg-text">#FFFFFF</span></div>
                        </div>
                    </div>
                </div>

                <!-- Brush Settings -->
                <div class="panel-section">
                    <div class="panel-title">Brush Settings</div>
                    <div class="setting-group">
                        <label class="setting-label">Size: <span id="size-value">10</span>px</label>
                        <input type="range" class="slider" id="brush-size" min="1" max="300" value="10">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Hardness: <span id="hardness-value">100</span>%</label>
                        <input type="range" class="slider" id="brush-hardness" min="0" max="100" value="100">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Opacity: <span id="opacity-value">100</span>%</label>
                        <input type="range" class="slider" id="brush-opacity" min="1" max="100" value="100">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Flow: <span id="flow-value">100</span>%</label>
                        <input type="range" class="slider" id="brush-flow" min="1" max="100" value="100">
                    </div>
                </div>

                <!-- Tools -->
                <div class="panel-section">
                    <div class="panel-title">Tools</div>
                    <div class="tools-grid">
                        <button class="tool-btn-grid active" data-tool="brush">🖌️ Brush</button>
                        <button class="tool-btn-grid" data-tool="eraser">🧹 Eraser</button>
                        <button class="tool-btn-grid" data-tool="eyedropper">💧 Eyedropper</button>
                        <button class="tool-btn-grid" data-tool="move">✋ Move</button>
                    </div>
                </div>
            </div>

            <!-- Canvas Area -->
            <div class="canvas-area" id="canvas-area">
                <div class="canvas-container" id="canvas-wrapper">
                    <canvas id="main-canvas" width="800" height="600"></canvas>
                </div>
            </div>

            <!-- Right Panels -->
            <div class="right-panels">
                <!-- Layers Panel -->
                <div class="panel-section">
                    <div class="panel-title">Layers</div>
                    <div id="layers-list">
                        <!-- Layers dynamically inserted here -->
                    </div>
                    <div class="layer-controls">
                        <button class="btn" id="add-layer-btn">Add Layer</button>
                        <button class="btn" id="delete-layer-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BrushesEditor {
             constructor() {
                this.dom = {
                    canvas: document.getElementById('main-canvas'),
                    canvasArea: document.getElementById('canvas-area'),
                    canvasWrapper: document.getElementById('canvas-wrapper'),
                    tools: document.querySelectorAll('.tool-btn-grid'),
                    layersList: document.getElementById('layers-list'),
                };
                
                this.ctx = this.dom.canvas.getContext('2d');

                this.state = {
                    docWidth: 800,
                    docHeight: 600,
                    currentTool: 'brush',
                    brush: {
                        size: 10,
                        hardness: 100,
                        opacity: 100,
                        flow: 100,
                        spacing: 25 // Default spacing, not in UI
                    },
                    colors: {
                        foreground: '#000000',
                        background: '#ffffff'
                    },
                    zoom: 1,
                    layers: [],
                    activeLayerId: null,
                    isDrawing: false,
                    lastPoint: null,
                    distMoved: 0,
                    history: [],
                    historyIndex: -1,
                };

                this.init();
            }

            init() {
                this.newDocument(this.state.docWidth, this.state.docHeight, true);
                this.initEventListeners();
                this.updateAllUI();
            }

            // --- DOCUMENT & FILE ---
            newDocument(width, height, isInitial = false) {
                this.state.docWidth = width;
                this.state.docHeight = height;
                this.dom.canvas.width = width;
                this.dom.canvas.height = height;

                this.state.layers = [];
                this.addLayer('Background', true); 
                
                if (!isInitial) {
                   this.state.history = [];
                   this.state.historyIndex = -1;
                   this.saveState('New Document');
                }

                this.setZoom(1);
                this.redrawAllLayers();
                this.updateAllUI();
            }
            
            openFile() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = res => {
                        const img = new Image();
                        img.onload = () => {
                            this.newDocument(img.width, img.height);
                            const bgLayer = this.getActiveLayer();
                            bgLayer.ctx.drawImage(img, 0, 0);
                            this.saveState('Open Image');
                            this.redrawAllLayers();
                        }
                        img.src = res.target.result;
                    }
                    reader.readAsDataURL(file);
                }
                input.click();
            }
            
            saveFile() {
                const link = document.createElement('a');
                link.download = 'brushes-export.png';
                link.href = this.dom.canvas.toDataURL('image/png');
                link.click();
                this.showToast('Image exported!', 'success');
            }

            // --- EVENT LISTENERS ---
            initEventListeners() {
                this.dom.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));
                window.addEventListener('mousemove', this.onMouseMove.bind(this));
                window.addEventListener('mouseup', this.onMouseUp.bind(this));

                // Tools
                this.dom.tools.forEach(tool => tool.addEventListener('click', () => this.selectTool(tool.dataset.tool)));

                // Brush Sliders
                ['size', 'hardness', 'opacity', 'flow'].forEach(prop => {
                    const slider = document.getElementById(`brush-${prop}`);
                    if (slider) {
                        slider.addEventListener('input', (e) => {
                            this.state.brush[prop] = parseFloat(e.target.value);
                            this.updateBrushSettingsUI();
                        });
                    }
                });
                
                // Colors
                document.getElementById('fg-color-input').addEventListener('input', (e) => { this.state.colors.foreground = e.target.value; this.updateColorUI(); });
                document.getElementById('bg-color-input').addEventListener('input', (e) => { this.state.colors.background = e.target.value; this.updateColorUI(); });
                
                // Top bar buttons
                document.getElementById('new-btn').addEventListener('click', () => this.newDocument(800, 600));
                document.getElementById('open-btn').addEventListener('click', () => this.openFile());
                document.getElementById('save-btn').addEventListener('click', () => this.saveFile());
                document.getElementById('undo-btn').addEventListener('click', () => this.undo());
                document.getElementById('redo-btn').addEventListener('click', () => this.redo());
                
                // Layer buttons
                document.getElementById('add-layer-btn').addEventListener('click', () => { this.addLayer(); this.saveState('Add Layer'); });
                document.getElementById('delete-layer-btn').addEventListener('click', () => { this.deleteLayer(); this.saveState('Delete Layer'); });
                
                // Zoom
                document.getElementById('zoom-in-btn').addEventListener('click', () => this.setZoom(this.state.zoom + 0.1));
                document.getElementById('zoom-out-btn').addEventListener('click', () => this.setZoom(this.state.zoom - 0.1));
            }
            
            // --- DRAWING ---
            getMousePos(e) {
                const rect = this.dom.canvas.getBoundingClientRect();
                const scale = this.dom.canvas.width / rect.width;
                return {
                    x: (e.clientX - rect.left) * scale,
                    y: (e.clientY - rect.top) * scale
                };
            }

            onMouseDown(e) {
                if (e.button !== 0) return;
                this.state.isDrawing = true;
                const pos = this.getMousePos(e);
                this.state.lastPoint = { x: pos.x, y: pos.y };
                this.state.distMoved = 0;

                const activeLayer = this.getActiveLayer();
                if (!activeLayer) return;
                
                const tool = this.state.currentTool;

                if (tool === 'brush' || tool === 'eraser') {
                    this.drawDot(activeLayer.ctx, pos.x, pos.y);
                    this.redrawAllLayers();
                } else if (tool === 'eyedropper') {
                    this.pickColor(pos.x, pos.y);
                }
            }

            onMouseMove(e) {
                if (!this.state.isDrawing) return;
                const pos = this.getMousePos(e);
                const activeLayer = this.getActiveLayer();
                if (!activeLayer) return;
                
                const tool = this.state.currentTool;

                if (tool === 'brush' || tool === 'eraser') {
                    const dist = Math.hypot(pos.x - this.state.lastPoint.x, pos.y - this.state.lastPoint.y);
                    const angle = Math.atan2(pos.y - this.state.lastPoint.y, pos.x - this.state.lastPoint.x);
                    const spacing = this.state.brush.size * (this.state.brush.spacing / 100);

                    for (let i = 0; i < dist; i += 1) {
                         const x = this.state.lastPoint.x + Math.cos(angle) * i;
                         const y = this.state.lastPoint.y + Math.sin(angle) * i;
                         this.drawDot(activeLayer.ctx, x, y);
                    }
                    this.redrawAllLayers();
                }

                this.state.lastPoint = { x: pos.x, y: pos.y };
            }
            
            onMouseUp(e) {
                if (!this.state.isDrawing) return;
                this.state.isDrawing = false;
                
                const tool = this.state.currentTool;
                if (tool === 'brush' || tool === 'eraser') {
                    this.saveState(tool === 'brush' ? 'Brush Stroke' : 'Eraser Stroke');
                }
            }

            drawDot(ctx, x, y) {
                const b = this.state.brush;
                const isEraser = this.state.currentTool === 'eraser';
                
                ctx.globalCompositeOperation = isEraser ? 'destination-out' : 'source-over';
                ctx.globalAlpha = b.opacity / 100 * (b.flow / 100);
                
                if (b.hardness >= 100) {
                    ctx.fillStyle = this.state.colors.foreground;
                    ctx.beginPath();
                    ctx.arc(x, y, b.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    const grad = ctx.createRadialGradient(x, y, 0, x, y, b.size / 2);
                    const hardness = b.hardness / 100;
                    const color = this.state.colors.foreground;
                    grad.addColorStop(0, color);
                    grad.addColorStop(hardness, color);
                    grad.addColorStop(1, `${color}00`);
                    ctx.fillStyle = grad;
                    ctx.fillRect(x - b.size / 2, y - b.size / 2, b.size, b.size);
                }
            }
            
            pickColor(x, y) {
                const pixel = this.ctx.getImageData(x, y, 1, 1).data;
                const hex = "#" + ("000000" + ((pixel[0] << 16) | (pixel[1] << 8) | pixel[2]).toString(16)).slice(-6);
                this.state.colors.foreground = hex;
                this.updateColorUI();
                this.showToast(`Color picked: ${hex}`, 'success');
            }

            // --- LAYERS ---
            addLayer(name = `Layer ${this.state.layers.length + 1}`, fillWhite = false) {
                const canvas = document.createElement('canvas');
                canvas.width = this.state.docWidth;
                canvas.height = this.state.docHeight;
                const ctx = canvas.getContext('2d');

                if (fillWhite) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                const newLayer = { id: Date.now(), name, visible: true, opacity: 100, canvas, ctx };

                this.state.layers.push(newLayer);
                this.setActiveLayer(newLayer.id);
            }

            deleteLayer() {
                if (this.state.layers.length <= 1) {
                    this.showToast('Cannot delete the background layer', 'error');
                    return;
                }
                const index = this.state.layers.findIndex(l => l.id === this.state.activeLayerId);
                this.state.layers.splice(index, 1);
                
                const newActiveIndex = Math.max(0, index - 1);
                this.setActiveLayer(this.state.layers[newActiveIndex]?.id);
                
                this.redrawAllLayers();
            }

            setActiveLayer(id) {
                this.state.activeLayerId = id;
                this.updateLayersUI();
            }

            getActiveLayer() {
                return this.state.layers.find(l => l.id === this.state.activeLayerId);
            }

            redrawAllLayers() {
                this.ctx.clearRect(0, 0, this.dom.canvas.width, this.dom.canvas.height);
                this.state.layers.forEach(layer => {
                    if (layer.visible) {
                        this.ctx.globalAlpha = layer.opacity / 100;
                        this.ctx.drawImage(layer.canvas, 0, 0);
                    }
                });
            }

            // --- HISTORY (UNDO/REDO) ---
            saveState(actionName) {
                if (this.state.historyIndex < this.state.history.length - 1) {
                    this.state.history = this.state.history.slice(0, this.state.historyIndex + 1);
                }
                const layerData = this.state.layers.map(l => ({ id: l.id, imageData: l.ctx.getImageData(0, 0, l.canvas.width, l.canvas.height) }));
                this.state.history.push({ actionName, layerData });
                this.state.historyIndex++;
                if (this.state.history.length > 30) {
                    this.state.history.shift();
                    this.state.historyIndex--;
                }
                this.updateHistoryButtons();
            }
            
            loadState(historyEntry) {
                 if (!historyEntry) return;
                 historyEntry.layerData.forEach(data => {
                     const layer = this.state.layers.find(l => l.id === data.id);
                     if(layer) layer.ctx.putImageData(data.imageData, 0, 0);
                 });
                 this.redrawAllLayers();
                 this.updateHistoryButtons();
            }
            
            undo() {
                if (this.state.historyIndex > 0) {
                    this.state.historyIndex--;
                    this.loadState(this.state.history[this.state.historyIndex]);
                }
            }
            
            redo() {
                if (this.state.historyIndex < this.state.history.length - 1) {
                    this.state.historyIndex++;
                    this.loadState(this.state.history[this.state.historyIndex]);
                }
            }
            
            updateHistoryButtons() {
                 document.getElementById('undo-btn').disabled = this.state.historyIndex <= 0;
                 document.getElementById('redo-btn').disabled = this.state.historyIndex >= this.state.history.length - 1;
            }

            // --- UI UPDATES ---
            updateAllUI() {
                this.updateBrushSettingsUI();
                this.updateColorUI();
                this.updateLayersUI();
                this.updateHistoryButtons();
            }
            
            updateBrushSettingsUI() {
                document.getElementById('size-value').textContent = this.state.brush.size;
                document.getElementById('hardness-value').textContent = this.state.brush.hardness;
                document.getElementById('opacity-value').textContent = this.state.brush.opacity;
                document.getElementById('flow-value').textContent = this.state.brush.flow;
            }

            updateColorUI() {
                document.getElementById('foreground-color-display').style.backgroundColor = this.state.colors.foreground;
                document.getElementById('background-color-display').style.backgroundColor = this.state.colors.background;
                document.getElementById('fg-text').textContent = this.state.colors.foreground.toUpperCase();
                document.getElementById('bg-text').textContent = this.state.colors.background.toUpperCase();
            }

            updateLayersUI() {
                this.dom.layersList.innerHTML = '';
                [...this.state.layers].reverse().forEach(layer => {
                    const item = document.createElement('div');
                    item.className = `layer-item ${layer.id === this.state.activeLayerId ? 'active' : ''}`;
                    item.innerHTML = `
                        <div class="layer-visibility">${layer.visible ? '👁️' : '➖'}</div>
                        <div class="layer-name">${layer.name}</div>
                    `;
                    item.addEventListener('click', () => this.setActiveLayer(layer.id));
                    item.querySelector('.layer-visibility').addEventListener('click', (e) => {
                        e.stopPropagation();
                        layer.visible = !layer.visible;
                        this.redrawAllLayers();
                        this.updateLayersUI();
                    });
                    this.dom.layersList.appendChild(item);
                });
            }
            
            selectTool(toolName) {
                this.state.currentTool = toolName;
                this.dom.tools.forEach(tool => {
                    tool.classList.toggle('active', tool.dataset.tool === toolName);
                });
                const cursors = { brush: 'crosshair', eraser: 'crosshair', eyedropper: 'cell', move: 'move' };
                this.dom.canvas.style.cursor = cursors[toolName] || 'default';
            }

            // --- ZOOM & VIEW ---
            setZoom(newZoom) {
                this.state.zoom = Math.max(0.1, Math.min(5, newZoom));
                this.dom.canvas.style.width = `${this.state.docWidth * this.state.zoom}px`;
                this.dom.canvas.style.height = `${this.state.docHeight * this.state.zoom}px`;
                document.getElementById('zoom-display').textContent = `${Math.round(this.state.zoom * 100)}%`;
            }
            
            // --- HELPERS ---
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            const editor = new BrushesEditor();
        });
    </script>
</body>
</html>

